<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Responsive Image with Placeholder</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .placeholder-box {
            border: 5px solid darkred;
            border-radius: 10px;
            position: absolute;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 200px;
            aspect-ratio: 9/13;
            overflow: hidden;
            top: 75%;
            left: 20%;
        }

        .placeholder-box img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #baseImage {
            max-width: 100%;
            height: auto;
        }

        @media (min-width: 768px) {
            .placeholder-box {
                max-width: 260px;
            }
        }

        @media (min-width: 992px) {
            .placeholder-box {
                max-width: 300px;
            }
        }
    </style>
</head>

<body>
    <div class="container text-center mt-5">
        <!-- File Input for Uploading Image -->
        <div class="mb-4">
            <input type="file" id="imageInput" class="form-control w-75 w-md-50 mx-auto" accept="image/*">
        </div>

        <!-- Submit Button -->
        <div class="mt-3">
            <button id="submitButton" class="btn btn-primary">Submit</button>
        </div>

        <!-- Base Image and Placeholder Section -->
        <div class="position-relative d-inline-block mt-4" style="display: none;" id="imageSection">
            <img src="./Untitled design (1).png" alt="Base Image" class="img-fluid rounded shadow-lg" id="baseImage">

            <!-- Placeholder Box -->
            <div class="container">
                <div class="placeholder-box" id="placeholderBox">
                    <!-- The uploaded image will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const imageInput = document.getElementById('imageInput');
        const submitButton = document.getElementById('submitButton');
        const imageSection = document.getElementById('imageSection');
        const placeholderBox = document.getElementById('placeholderBox');
        const baseImage = document.getElementById('baseImage');

        let uploadedImage = null;

        // Handle image input
        imageInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    uploadedImage = new Image();
                    uploadedImage.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // Handle submit button click
        submitButton.addEventListener('click', () => {
            if (uploadedImage) {
                placeholderBox.innerHTML = '';
                placeholderBox.appendChild(uploadedImage);
                uploadedImage.style.width = '100%';
                uploadedImage.style.height = '100%';

                // Show the image section
                imageSection.style.display = 'block';

                // Automatically download the composed image
                setTimeout(() => downloadComposedImage(), 500);
            } else {
                alert('Please upload an image first.');
            }
        });

        function downloadComposedImage() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');

            canvas.width = baseImage.naturalWidth;
            canvas.height = baseImage.naturalHeight;

            // Draw the base image
            ctx.drawImage(baseImage, 0, 0, canvas.width, canvas.height);

            // Draw the uploaded placeholder image
            const placeholderImage = placeholderBox.querySelector('img');
            if (placeholderImage) {
                const placeholderRect = placeholderBox.getBoundingClientRect();
                const baseRect = baseImage.getBoundingClientRect();

                const xOffset = placeholderRect.left - baseRect.left;
                const yOffset = placeholderRect.top - baseRect.top;

                ctx.drawImage(
                    placeholderImage,
                    (xOffset / baseRect.width) * canvas.width,
                    (yOffset / baseRect.height) * canvas.height,
                    (placeholderRect.width / baseRect.width) * canvas.width,
                    (placeholderRect.height / baseRect.height) * canvas.height
                );
            }

            // Convert canvas to JPEG and download
            const imgData = canvas.toDataURL('image/jpeg', 1.0);
            const link = document.createElement('a');
            link.href = imgData;
            link.download = 'image_with_placeholder.jpg';
            link.click();
        }
    </script>
</body>

</html>
